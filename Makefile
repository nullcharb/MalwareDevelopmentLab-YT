# to call the make file 
# run the below sample command on the terminal
# make output=sample.exe

# flags are explained in below article:
# https://www.systutorials.com/docs/linux/man/1-x86_64-w64-mingw32-gcc/
# also review this article from Stackoverflow
# https://stackoverflow.com/questions/42022132/how-to-create-tiny-pe-win32-executables-using-mingw

GCCX64	:= x86_64-w64-mingw32-gcc # path of the compiler.

CFLAGS	:= -Os -fno-asynchronous-unwind-tables
CFLAGS 	+= -fno-ident -fpack-struct=8 -falign-functions=1
CFLAGS  += -s -ffunction-sections -falign-jumps=1 -w
CFLAGS	+= -falign-labels=1 -fPIC
CFLAGS	+= -Wl,-s,--no-seh,--enable-stdcall-fixup
DEBUG   := -Wl,--no-dynamicbase -Wl,--no-nxcompat -g


OUTPUTX64	:= $(output)

all: x64

x64:
	@ echo Compile executable...
	# @ python3 ./extractShellcode.py
	@ $(GCCX64) *.c -o $(OUTPUTX64) $(CFLAGS) -IInclude -lntdll

Debugx64:
	@ echo Compile executable...
	@ $(GCCX64) *.c -o $(OUTPUTX64) $(CFLAGS) $(DEBUG) -IInclude -lntdll

clean:
	@ rm -rf *.exe